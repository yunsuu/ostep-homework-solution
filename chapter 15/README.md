# Before read

This post is about the practical exercises of 'Operating Systems: Principles and Practice.' Please read the linked article and check out the posting

https://github.com/remzi-arpacidusseau/ostep-homework/tree/master/vm-mechanism

The program `relocation.py` allows you to see how address translations are performed in a system with base and bounds registers. See the README for details.

# Q1

Run with seeds 1, 2, and 3, and compute whether each virtual address generated by the process is in or out of bounds. If in bounds, compute the translation.

### command

```
$ python relocation.py -s 1 -c
$ python relocation.py -s 2 -c
$ python relocation.py -s 3 -c
```

### result

```
ARG seed 1
ARG address space size 1k
ARG phys mem size 16k

Base-and-Bounds register information:

  Base   : 0x0000363c (decimal 13884)
  Limit  : 290

Virtual Address Trace
  VA  0: 0x0000030e (decimal:  782) --> SEGMENTATION VIOLATION
  VA  1: 0x00000105 (decimal:  261) --> VALID: 0x00003741 (decimal: 14145)
  VA  2: 0x000001fb (decimal:  507) --> SEGMENTATION VIOLATION
  VA  3: 0x000001cc (decimal:  460) --> SEGMENTATION VIOLATION
  VA  4: 0x0000029b (decimal:  667) --> SEGMENTATION VIOLATION
```

# Q2

Run with these flags: `s 0 -n 10`. What value do you have set `l` (the bounds register) to in order to ensure that all the generated virtual addresses are within bounds?

address space size가 1k, 1k = 1024 을 의미한다. 즉 가상메모리의 범위는  base rigister ~ base rigister + 1000 이다.

### command

```
$ python relocation.py -s 1 -n 10 -l 1000 -c
```

### reuslt

```
ARG seed 164
ARG address space size 1k
ARG phys mem size 16k

Base-and-Bounds register information:

  Base   : 0x00000619 (decimal 1561)
  Limit  : 1000

Virtual Address Trace
  VA  0: 0x00000134 (decimal:  308) --> VALID: 0x0000074d (decimal: 1869)
  VA  1: 0x000003c6 (decimal:  966) --> VALID: 0x000009df (decimal: 2527)
  VA  2: 0x000001da (decimal:  474) --> VALID: 0x000007f3 (decimal: 2035)
  VA  3: 0x0000026b (decimal:  619) --> VALID: 0x00000884 (decimal: 2180)
  VA  4: 0x0000007b (decimal:  123) --> VALID: 0x00000694 (decimal: 1684)
  VA  5: 0x000001a8 (decimal:  424) --> VALID: 0x000007c1 (decimal: 1985)
  VA  6: 0x00000004 (decimal:    4) --> VALID: 0x0000061d (decimal: 1565)
  VA  7: 0x00000374 (decimal:  884) --> VALID: 0x0000098d (decimal: 2445)
  VA  8: 0x000000c1 (decimal:  193) --> VALID: 0x000006da (decimal: 1754)
  VA  9: 0x00000361 (decimal:  865) --> VALID: 0x0000097a (decimal: 2426)
```

# Q3

Run with these flags: `s 1 -n 10 -l 100`. What is the maximum value that base can be set to, such that the address space still fits into physical memory in its entirety?

16k = 16 * 1024 = 16384

16384-100 = 16284

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/26bd9f65-76d8-4c7f-9a11-543ae5fc2ad6/af9bb315-12ad-4bf4-bb96-ac80b34e9829/Untitled.png)

### command

```
python relocation.py -s 1 -n 10 -l 100 -b 16284 -c
```

### reuslt

```
ARG seed 1
ARG address space size 1k
ARG phys mem size 16k

Base-and-Bounds register information:

  Base   : 0x00003f9c (decimal 16284)
  Limit  : 100

Virtual Address Trace
  VA  0: 0x00000089 (decimal:  137) --> SEGMENTATION VIOLATION
  VA  1: 0x00000363 (decimal:  867) --> SEGMENTATION VIOLATION
  VA  2: 0x0000030e (decimal:  782) --> SEGMENTATION VIOLATION
  VA  3: 0x00000105 (decimal:  261) --> SEGMENTATION VIOLATION
  VA  4: 0x000001fb (decimal:  507) --> SEGMENTATION VIOLATION
  VA  5: 0x000001cc (decimal:  460) --> SEGMENTATION VIOLATION
  VA  6: 0x0000029b (decimal:  667) --> SEGMENTATION VIOLATION
  VA  7: 0x00000327 (decimal:  807) --> SEGMENTATION VIOLATION
  VA  8: 0x00000060 (decimal:   96) --> VALID: 0x00003ffc (decimal: 16380)
  VA  9: 0x0000001d (decimal:   29) --> VALID: 0x00003fb9 (decimal: 16313)
```

# Q4

Run some of the same problems above, but with larger address spaces (`a`) and physical memories (`p`).

### command

```
python relocation.py -s 1 -n 10 -l 100 -b 16284 -c -a 32m -p 1g
```

### result

```
ARG seed 1
ARG address space size 32m
ARG phys mem size 1g

Base-and-Bounds register information:

  Base   : 0x00003f9c (decimal 16284)
  Limit  : 100

Virtual Address Trace
  VA  0: 0x0044cb63 (decimal: 4508515) --> SEGMENTATION VIOLATION
  VA  1: 0x01b1e2d5 (decimal: 28435157) --> SEGMENTATION VIOLATION
  VA  2: 0x01870d77 (decimal: 25628023) --> SEGMENTATION VIOLATION
  VA  3: 0x00829868 (decimal: 8558696) --> SEGMENTATION VIOLATION
  VA  4: 0x00fda9aa (decimal: 16624042) --> SEGMENTATION VIOLATION
  VA  5: 0x00e623b1 (decimal: 15082417) --> SEGMENTATION VIOLATION
  VA  6: 0x014d9d98 (decimal: 21863832) --> SEGMENTATION VIOLATION
  VA  7: 0x0193d38c (decimal: 26465164) --> SEGMENTATION VIOLATION
  VA  8: 0x00300e5d (decimal: 3149405) --> SEGMENTATION VIOLATION
  VA  9: 0x000e838f (decimal: 951183) --> SEGMENTATION VIOLATION
```

# Q5

What fraction of randomly-generated virtual addresses are valid, as a function of the value of the bounds register? Make a graph from running with different random seeds, with limit values ranging from 0 up to the maximum size of the address space.
